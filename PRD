# PRD - FinAuto: Aplicativo de Gestão Financeira Pessoal

**Versão:** 1.0  
**Data:** 08/12/2025  
**Linguagem de Programação:** TypeScript, Shadcn-ui, Tailwind CSS  
**Backend Service:** Supabase  
**Nome do Projeto:** finauto_app  

---

## 1. Requisitos Originais

Desenvolver um aplicativo de gestão financeira pessoal (FinAuto) que auxilie adultos iniciantes em finanças a organizarem suas receitas, despesas e metas financeiras de forma simples e segura. O aplicativo deve:

- Validar que todos os usuários são maiores de 18 anos
- Implementar interface conversacional intuitiva
- Fornecer dashboard visual de finanças
- Permitir registro em planilha de transações
- Gerenciar metas financeiras
- Garantir conformidade total com LGPD
- Implementar KYC (Know Your Customer)
- Aplicar medidas robustas de segurança e antifraude
- Utilizar arquitetura segura com RBAC, RLS, MFA e criptografia
- Não fornecer recomendações financeiras personalizadas
- Usar linguagem educativa e simples

---

## 2. Definição do Produto

### 2.1 Objetivos do Produto

1. **Democratizar a Educação Financeira**: Tornar a gestão financeira acessível para adultos iniciantes através de interface conversacional e linguagem simples, sem jargões técnicos.

2. **Garantir Segurança e Conformidade**: Implementar os mais altos padrões de segurança de dados financeiros, conformidade com LGPD e proteção contra fraudes, construindo confiança do usuário.

3. **Promover Autonomia Financeira**: Capacitar usuários a tomarem decisões financeiras informadas através de visualizações claras, alertas educativos e ferramentas de planejamento, sem indução ou recomendações personalizadas.

### 2.2 User Stories

**US1 - Cadastro Seguro**
> Como um adulto iniciante em finanças, quero me cadastrar de forma simples mas segura, para que eu possa começar a organizar minhas finanças com confiança de que meus dados estão protegidos.

**US2 - Registro Conversacional de Transações**
> Como um usuário sem experiência com planilhas, quero registrar minhas despesas e receitas conversando naturalmente com o app, para que eu não precise aprender termos técnicos ou navegar por formulários complexos.

**US3 - Visualização Clara do Orçamento**
> Como alguém que quer entender para onde vai meu dinheiro, quero ver um dashboard visual simples das minhas finanças, para que eu possa identificar rapidamente onde estou gastando mais.

**US4 - Definição de Metas Financeiras**
> Como um usuário que quer poupar para objetivos específicos, quero criar e acompanhar metas financeiras, para que eu me mantenha motivado e organizado no caminho para alcançá-las.

**US5 - Controle e Privacidade de Dados**
> Como um usuário preocupado com privacidade, quero ter controle total sobre meus dados pessoais e financeiros, para que eu possa decidir o que compartilhar e solicitar exclusão quando desejar.

### 2.3 Análise Competitiva

| Produto | Pros | Cons |
|---------|------|------|
| **Mobills** | Interface brasileira intuitiva, categorização automática, relatórios visuais | Versão gratuita limitada, não possui interface conversacional, curva de aprendizado para iniciantes |
| **GuiaBolso** | Integração bancária automática, análise de crédito, gratuito | Preocupações com privacidade de dados bancários, interface pode ser confusa para iniciantes, foco em produtos financeiros |
| **Organizze** | Simples e direto, boa para iniciantes, sincronização multi-dispositivo | Recursos limitados, sem IA ou assistente conversacional, design datado |
| **Minhas Economias** | Gratuito, interface limpa, bom para controle básico | Poucos recursos avançados, sem automação, entrada manual trabalhosa |
| **YNAB (You Need A Budget)** | Metodologia forte de orçamento, educação financeira, comunidade ativa | Caro (subscription), curva de aprendizado alta, interface em inglês, não focado no mercado brasileiro |
| **Wallet by BudgetBakers** | Design moderno, multi-moeda, relatórios detalhados | Complexo para iniciantes, alguns recursos pagos, suporte limitado em português |
| **PocketGuard** | Automação inteligente, "In My Pocket" feature, alertas proativos | Disponível apenas em inglês, integração bancária limitada no Brasil, modelo freemium restritivo |

### 2.4 Quadrante Competitivo

```mermaid
quadrantChart
    title "Análise Competitiva - Facilidade vs Recursos"
    x-axis "Baixa Facilidade de Uso" --> "Alta Facilidade de Uso"
    y-axis "Poucos Recursos" --> "Muitos Recursos"
    quadrant-1 "Líderes de Mercado"
    quadrant-2 "Nicho Premium"
    quadrant-3 "Básicos"
    quadrant-4 "Oportunidade"
    "Mobills": [0.65, 0.70]
    "GuiaBolso": [0.50, 0.75]
    "Organizze": [0.75, 0.45]
    "Minhas Economias": [0.70, 0.35]
    "YNAB": [0.40, 0.85]
    "Wallet": [0.55, 0.65]
    "PocketGuard": [0.60, 0.60]
    "FinAuto (Alvo)": [0.85, 0.55]
```

**Posicionamento do FinAuto**: Quadrante 4 (Oportunidade) - Alta facilidade de uso com recursos essenciais bem executados, diferenciando-se pela interface conversacional e foco em iniciantes.

---

## 3. Análise de Requisitos

### 3.1 Visão Geral Técnica

O FinAuto será desenvolvido como uma aplicação web progressiva (PWA) com as seguintes características técnicas fundamentais:

**Arquitetura Frontend:**
- Framework: React com TypeScript para type-safety
- UI Components: Shadcn-ui para componentes acessíveis e customizáveis
- Styling: Tailwind CSS para design responsivo e consistente
- State Management: React Context API + React Query para cache e sincronização
- PWA: Service Workers para funcionalidade offline e instalação

**Arquitetura Backend:**
- BaaS: Supabase (PostgreSQL + Auth + Storage + Edge Functions)
- Database: PostgreSQL 14+ com extensões pgcrypto e RLS
- Authentication: Supabase Auth com MFA obrigatório
- Storage: Supabase Storage com criptografia SSE
- Real-time: Supabase Realtime para sincronização

**IA e Processamento de Linguagem Natural:**
- NLU Engine: OpenAI GPT-4 ou similar para interface conversacional
- Intent Recognition: Classificação de intenções (adicionar despesa, consultar saldo, criar meta)
- Entity Extraction: Extração de valores, datas, categorias e descrições
- Fallback: Interface tradicional sempre disponível

**Segurança e Conformidade:**
- Criptografia: TLS 1.3 em trânsito, pgcrypto em repouso
- Autenticação: JWT com refresh tokens, MFA obrigatório
- Autorização: RBAC + RLS no nível de banco de dados
- KYC: Validação de idade e identidade com serviço externo
- LGPD: Consentimentos granulares, direito ao esquecimento, anonimização
- Antifraude: Rate limiting, detecção de anomalias, bloqueio automático

### 3.2 Requisitos Funcionais Prioritizados

#### P0 - Críticos (Must-Have para MVP)

**RF001 - Cadastro e Validação de Idade**
- O sistema MUST validar que o usuário tem 18 anos ou mais durante o cadastro
- O sistema MUST solicitar data de nascimento e calcular idade automaticamente
- O sistema MUST bloquear cadastros de menores de 18 anos com mensagem clara
- O sistema MUST armazenar flag `is_adult` no banco de dados
- O sistema MUST implementar trigger SQL para validação adicional

**RF002 - Autenticação Segura com MFA**
- O sistema MUST implementar autenticação via email/senha com bcrypt/argon2
- O sistema MUST exigir MFA (TOTP ou SMS) para todos os usuários
- O sistema MUST implementar tokens JWT com expiração curta (15 min)
- O sistema MUST implementar refresh tokens seguros
- O sistema MUST implementar proteção contra brute force (rate limiting)

**RF003 - Processo KYC**
- O sistema MUST implementar status KYC: pending, in_review, approved, rejected
- O sistema MUST limitar funcionalidades para usuários não verificados
- O sistema MUST integrar com serviço KYC externo (ex: Serpro, Serasa)
- O sistema MUST armazenar hash do documento (não o documento em si)
- O sistema MUST auditar todas as tentativas de verificação

**RF004 - Interface Conversacional**
- O sistema MUST permitir entrada de transações via texto natural
- O sistema MUST reconhecer intenções: adicionar receita/despesa, consultar saldo, criar meta
- O sistema MUST extrair entidades: valor, data, categoria, descrição
- O sistema MUST confirmar interpretação antes de salvar
- O sistema MUST fornecer fallback para interface tradicional

**RF005 - Registro de Transações**
- O sistema MUST permitir registro manual de receitas e despesas
- O sistema MUST categorizar transações (alimentação, transporte, moradia, etc.)
- O sistema MUST permitir anexar notas e comprovantes criptografados
- O sistema MUST validar valores positivos e datas válidas
- O sistema MUST registrar timestamp de criação e modificação

**RF006 - Dashboard Financeiro**
- O sistema MUST exibir saldo atual (receitas - despesas)
- O sistema MUST exibir gráfico de despesas por categoria (último mês)
- O sistema MUST exibir tendência mensal (comparação com mês anterior)
- O sistema MUST exibir progresso de metas ativas
- O sistema MUST atualizar dados em tempo real

**RF007 - Gerenciamento de Metas**
- O sistema MUST permitir criar metas com nome, valor alvo e prazo
- O sistema MUST calcular progresso automaticamente baseado em saldo
- O sistema MUST exibir projeção de alcance da meta
- O sistema MUST enviar alertas de progresso (25%, 50%, 75%, 100%)
- O sistema MUST permitir pausar, editar ou excluir metas

**RF008 - Conformidade LGPD**
- O sistema MUST solicitar consentimentos granulares no cadastro
- O sistema MUST permitir visualização e revogação de consentimentos
- O sistema MUST implementar exportação de dados (portabilidade)
- O sistema MUST implementar exclusão de conta com anonimização
- O sistema MUST manter registro de auditoria de consentimentos

**RF009 - Controle de Acesso (RBAC + RLS)**
- O sistema MUST implementar roles: admin, service, app, readonly
- O sistema MUST aplicar RLS em todas as tabelas de usuário
- O sistema MUST garantir isolamento de dados entre usuários
- O sistema MUST implementar least privilege em todos os níveis
- O sistema MUST auditar tentativas de acesso não autorizado

**RF010 - Criptografia de Dados Sensíveis**
- O sistema MUST criptografar senhas com bcrypt/argon2
- O sistema MUST criptografar notas e documentos com pgcrypto
- O sistema MUST usar TLS 1.3 para todas as comunicações
- O sistema MUST armazenar chaves de criptografia em KMS
- O sistema MUST criptografar backups

#### P1 - Importantes (Should-Have pós-MVP)

**RF011 - Planilha de Transações**
- O sistema SHOULD exibir histórico completo em formato tabular
- O sistema SHOULD permitir filtros por data, categoria e tipo
- O sistema SHOULD permitir ordenação por colunas
- O sistema SHOULD permitir busca por descrição
- O sistema SHOULD permitir exportação para CSV

**RF012 - Categorização Inteligente**
- O sistema SHOULD sugerir categorias baseado em histórico
- O sistema SHOULD aprender padrões de gasto do usuário
- O sistema SHOULD permitir criação de categorias customizadas
- O sistema SHOULD agrupar categorias em grupos (essencial, lazer, investimento)

**RF013 - Alertas e Notificações**
- O sistema SHOULD enviar alertas de gastos acima da média
- O sistema SHOULD notificar quando meta está próxima de ser alcançada
- O sistema SHOULD alertar sobre ações sensíveis (exclusão, alteração de senha)
- O sistema SHOULD permitir configuração de preferências de notificação

**RF014 - Relatórios Mensais**
- O sistema SHOULD gerar relatório automático no fim do mês
- O sistema SHOULD comparar gastos mês a mês
- O sistema SHOULD identificar categorias com maior variação
- O sistema SHOULD exibir insights educativos (não recomendações)

**RF015 - Backup e Recuperação**
- O sistema SHOULD realizar backups automáticos diários
- O sistema SHOULD testar restauração mensalmente
- O sistema SHOULD manter backups por 90 dias
- O sistema SHOULD criptografar todos os backups

#### P2 - Desejáveis (May-Have futuro)

**RF016 - Integração Bancária**
- O sistema MAY integrar com Open Banking para importação automática
- O sistema MAY categorizar transações importadas automaticamente
- O sistema MAY conciliar transações manuais com importadas

**RF017 - Modo Família**
- O sistema MAY permitir compartilhamento de orçamento entre membros
- O sistema MAY implementar permissões granulares por membro
- O sistema MAY separar transações pessoais de compartilhadas

**RF018 - Gamificação**
- O sistema MAY implementar badges por conquistas financeiras
- O sistema MAY criar desafios mensais de economia
- O sistema MAY exibir streak de dias com registro de transações

### 3.3 Requisitos Não-Funcionais

**RNF001 - Performance**
- Tempo de resposta da interface conversacional < 2s (P95)
- Carregamento do dashboard < 1s (P95)
- Suporte a 10.000 usuários simultâneos
- Database queries < 100ms (P95)

**RNF002 - Disponibilidade**
- SLA de 99.5% de uptime
- Manutenções programadas fora do horário comercial
- Degradação graciosa em caso de falhas
- Modo offline para consultas (PWA)

**RNF003 - Segurança**
- Conformidade com OWASP Top 10
- Penetration tests trimestrais
- Vulnerability scanning automatizado
- Incident response plan documentado
- Security headers (CSP, HSTS, etc.)

**RNF004 - Escalabilidade**
- Arquitetura stateless para horizontal scaling
- Database connection pooling
- CDN para assets estáticos
- Cache em múltiplas camadas

**RNF005 - Observabilidade**
- Logging estruturado com redação de PII
- Métricas de negócio e técnicas
- Distributed tracing
- Alertas proativos de anomalias
- Dashboards de monitoramento

**RNF006 - Acessibilidade**
- Conformidade WCAG 2.1 nível AA
- Suporte a leitores de tela
- Navegação por teclado completa
- Contraste adequado de cores
- Textos alternativos em imagens

**RNF007 - Usabilidade**
- Linguagem simples (nível fundamental)
- Onboarding interativo < 3 minutos
- Máximo 3 cliques para qualquer ação principal
- Feedback visual em todas as ações
- Mensagens de erro claras e acionáveis

---

## 4. MVP Detalhado

### 4.1 Escopo do MVP

O MVP do FinAuto focará em entregar as funcionalidades essenciais (P0) que permitem a um usuário adulto:
1. Cadastrar-se de forma segura com validação de idade e KYC
2. Registrar receitas e despesas via interface conversacional ou manual
3. Visualizar dashboard com saldo e gastos por categoria
4. Criar e acompanhar metas financeiras básicas
5. Ter controle total sobre seus dados (LGPD)

**Fora do Escopo do MVP:**
- Integração bancária automática
- Relatórios avançados e exportação
- Modo família/compartilhamento
- Gamificação
- Aplicativo mobile nativo (apenas PWA)

### 4.2 Etapas de Desenvolvimento

#### Fase 1: Fundação e Segurança (Semanas 1-3)

**Sprint 1.1 - Infraestrutura Base**
- Configurar repositório GitHub com estrutura de pastas
- Configurar Supabase project (database, auth, storage)
- Implementar Docker Compose para desenvolvimento local
- Configurar CI/CD com GitHub Actions
- Criar .env.example e documentação de secrets
- Implementar estrutura base do frontend (React + TypeScript + Shadcn-ui)

**Sprint 1.2 - Banco de Dados e Segurança**
- Criar schema completo do PostgreSQL (ver seção 5)
- Implementar migrations versionadas
- Configurar pgcrypto e criptografia
- Implementar RBAC com roles (admin, service, app, readonly)
- Implementar RLS em todas as tabelas
- Criar triggers de validação de idade
- Implementar auditoria (product_events)
- Configurar backups automáticos

**Sprint 1.3 - Autenticação e KYC**
- Implementar cadastro com validação de idade
- Implementar autenticação com Supabase Auth
- Implementar MFA obrigatório (TOTP)
- Implementar fluxo de KYC com status
- Implementar rate limiting e proteção brute force
- Implementar recuperação de senha segura
- Testes de segurança básicos

**Entregáveis Fase 1:**
- ✅ Infraestrutura completa e documentada
- ✅ Banco de dados seguro com RLS e criptografia
- ✅ Autenticação robusta com MFA
- ✅ KYC funcional com validação de idade
- ✅ CI/CD operacional

#### Fase 2: Funcionalidades Core (Semanas 4-6)

**Sprint 2.1 - Registro de Transações**
- Implementar modelo de dados de transações
- Criar interface de registro manual (formulário)
- Implementar validações de entrada
- Implementar categorização básica
- Implementar anexo de notas criptografadas
- Implementar listagem de transações

**Sprint 2.2 - Interface Conversacional**
- Integrar NLU engine (OpenAI API)
- Implementar reconhecimento de intenções
- Implementar extração de entidades
- Criar interface de chat
- Implementar confirmação de interpretação
- Implementar fallback para formulário
- Implementar histórico de conversas

**Sprint 2.3 - Dashboard**
- Implementar cálculo de saldo
- Criar gráfico de despesas por categoria
- Implementar comparação mensal
- Criar cards de resumo
- Implementar atualização em tempo real
- Otimizar queries de agregação

**Entregáveis Fase 2:**
- ✅ Registro de transações funcional (manual e conversacional)
- ✅ Dashboard visual com métricas principais
- ✅ Interface conversacional intuitiva
- ✅ Performance adequada (< 2s resposta)

#### Fase 3: Metas e LGPD (Semanas 7-8)

**Sprint 3.1 - Gerenciamento de Metas**
- Implementar modelo de dados de metas
- Criar interface de criação de metas
- Implementar cálculo de progresso
- Implementar projeção de alcance
- Criar visualização de progresso
- Implementar alertas de milestone

**Sprint 3.2 - Conformidade LGPD**
- Implementar gestão de consentimentos
- Criar interface de privacidade
- Implementar exportação de dados
- Implementar exclusão de conta com anonimização
- Criar política de privacidade e termos de uso
- Implementar auditoria de consentimentos
- Documentar processos de LGPD

**Entregáveis Fase 3:**
- ✅ Sistema de metas funcional
- ✅ Conformidade total com LGPD
- ✅ Controle de dados pelo usuário
- ✅ Documentação legal completa

#### Fase 4: Polimento e Validação (Semanas 9-10)

**Sprint 4.1 - UX e Acessibilidade**
- Implementar onboarding interativo
- Adicionar microfeedbacks e animações
- Implementar mensagens educativas
- Garantir conformidade WCAG 2.1 AA
- Implementar navegação por teclado
- Otimizar para mobile (responsive)
- Implementar PWA (service workers)

**Sprint 4.2 - Testes e Observabilidade**
- Implementar testes unitários (>80% coverage)
- Implementar testes de integração
- Implementar testes E2E (Playwright)
- Configurar logging estruturado
- Implementar métricas e dashboards
- Realizar penetration test
- Realizar testes de carga

**Sprint 4.3 - Documentação e Deploy**
- Documentar APIs e componentes
- Criar guia de contribuição
- Criar runbook operacional
- Configurar ambiente de staging
- Deploy em produção
- Configurar monitoramento
- Treinamento da equipe de suporte

**Entregáveis Fase 4:**
- ✅ UX polida e acessível
- ✅ Cobertura de testes adequada
- ✅ Observabilidade completa
- ✅ Documentação completa
- ✅ MVP em produção

### 4.3 Validação de Idade e KYC

**Fluxo de Cadastro com Validação:**

```mermaid
flowchart TD
    A[Início do Cadastro] --> B[Solicitar Email e Senha]
    B --> C[Solicitar Data de Nascimento]
    C --> D{Idade >= 18?}
    D -->|Não| E[Bloquear Cadastro]
    E --> F[Exibir Mensagem: Serviço apenas para maiores de 18 anos]
    F --> G[Fim]
    D -->|Sim| H[Criar Conta com is_adult=true]
    H --> I[Enviar Email de Verificação]
    I --> J[Configurar MFA Obrigatório]
    J --> K[Definir kyc_status=pending]
    K --> L[Solicitar Documento para KYC]
    L --> M[Enviar para Serviço KYC Externo]
    M --> N{KYC Aprovado?}
    N -->|Não| O[kyc_status=rejected]
    O --> P[Limitar Funcionalidades]
    P --> Q[Permitir Nova Tentativa]
    N -->|Sim| R[kyc_status=approved]
    R --> S[Liberar Todas Funcionalidades]
    S --> T[Fim]
```

**Validações Implementadas:**

1. **Frontend:**
   - Validação de data de nascimento no formulário
   - Cálculo de idade em JavaScript
   - Bloqueio de submit se idade < 18
   - Mensagem clara e educativa

2. **Backend (Supabase Edge Function):**
   - Recálculo de idade no servidor
   - Validação antes de criar usuário
   - Retorno de erro 403 se idade < 18
   - Log de tentativas de cadastro de menores

3. **Database (PostgreSQL Trigger):**
   ```sql
   CREATE OR REPLACE FUNCTION check_user_age()
   RETURNS TRIGGER AS $$
   BEGIN
       IF NEW.birthdate IS NOT NULL THEN
           IF EXTRACT(YEAR FROM AGE(NEW.birthdate)) < 18 THEN
               RAISE EXCEPTION 'Usuário deve ter 18 anos ou mais';
           END IF;
           NEW.is_adult := EXTRACT(YEAR FROM AGE(NEW.birthdate)) >= 18;
       END IF;
       RETURN NEW;
   END;
   $$ LANGUAGE plpgsql;

   CREATE TRIGGER validate_user_age
   BEFORE INSERT OR UPDATE ON users
   FOR EACH ROW EXECUTE FUNCTION check_user_age();
   ```

4. **KYC Process:**
   - Integração com serviço externo (Serpro/Serasa)
   - Validação de documento oficial
   - Verificação de liveness (selfie)
   - Armazenamento apenas de hash do documento
   - Auditoria completa do processo

**Limitações para Usuários Não Verificados:**
- Limite de 10 transações por mês
- Sem anexo de comprovantes
- Sem exportação de dados
- Sem acesso a relatórios avançados
- Banner persistente solicitando verificação

### 4.4 Requisitos de LGPD

**Princípios Implementados:**

1. **Finalidade:** Coleta de dados apenas para gestão financeira pessoal
2. **Adequação:** Dados compatíveis com a finalidade declarada
3. **Necessidade:** Coleta mínima necessária
4. **Livre Acesso:** Usuário pode consultar seus dados a qualquer momento
5. **Qualidade dos Dados:** Dados precisos e atualizados
6. **Transparência:** Informações claras sobre tratamento
7. **Segurança:** Medidas técnicas e administrativas robustas
8. **Prevenção:** Medidas para evitar danos
9. **Não Discriminação:** Sem tratamento discriminatório
10. **Responsabilização:** Demonstração de conformidade

**Consentimentos Granulares:**

```typescript
interface UserConsents {
  essential_processing: boolean;        // Obrigatório
  marketing_communications: boolean;    // Opcional
  data_analytics: boolean;              // Opcional
  third_party_sharing: boolean;         // Opcional (sempre false no MVP)
}
```

**Direitos do Titular:**

1. **Confirmação e Acesso:** Visualizar dados em "Meus Dados"
2. **Correção:** Editar dados pessoais
3. **Anonimização/Bloqueio:** Pausar processamento
4. **Eliminação:** Excluir conta com anonimização
5. **Portabilidade:** Exportar dados em JSON
6. **Informação:** Acesso a política de privacidade
7. **Revogação:** Revogar consentimentos opcionais

**Processo de Exclusão de Conta:**

```mermaid
flowchart TD
    A[Usuário Solicita Exclusão] --> B[Confirmar Identidade MFA]
    B --> C[Exibir Aviso: Ação Irreversível]
    C --> D{Confirmar Exclusão?}
    D -->|Não| E[Cancelar]
    D -->|Sim| F[Iniciar Processo de Anonimização]
    F --> G[Anonimizar Dados Pessoais]
    G --> H[Manter Dados Agregados Anonimizados]
    H --> I[Registrar Exclusão em Auditoria]
    I --> J[Enviar Email de Confirmação]
    J --> K[Desativar Conta]
    K --> L[Fim]
```

**Retenção de Dados:**
- Dados transacionais: 5 anos (obrigação legal contábil)
- Dados pessoais: Até exclusão de conta
- Logs de auditoria: 5 anos
- Backups: 90 dias, depois anonimizados

### 4.5 Segurança e Antifraude

**Medidas de Segurança Implementadas:**

1. **Autenticação:**
   - Senhas com bcrypt (cost factor 12)
   - MFA obrigatório (TOTP)
   - JWT com expiração curta (15 min)
   - Refresh tokens rotativos
   - Logout em todos os dispositivos

2. **Autorização:**
   - RBAC com 4 roles
   - RLS em todas as tabelas
   - Least privilege
   - Validação em múltiplas camadas

3. **Criptografia:**
   - TLS 1.3 em trânsito
   - pgcrypto para dados em repouso
   - Chaves no KMS
   - Backups criptografados

4. **Proteção de API:**
   - Rate limiting (100 req/min por IP)
   - Brute force protection (5 tentativas)
   - CORS configurado
   - Security headers (CSP, HSTS, etc.)
   - Input sanitization

5. **Monitoramento:**
   - Detecção de anomalias
   - Alertas de acesso suspeito
   - Logs de auditoria
   - SIEM integration

**Sistema Antifraude:**

```typescript
interface FraudDetectionRules {
  // Velocidade
  max_transactions_per_hour: 20;
  max_transactions_per_day: 100;
  
  // Valor
  max_transaction_value: 100000; // R$ 100k
  unusual_value_threshold: 10x_average;
  
  // Comportamento
  unusual_time_pattern: boolean;
  unusual_location_pattern: boolean;
  multiple_failed_auth: number;
  
  // Dispositivo
  new_device_high_value: boolean;
  multiple_devices_short_time: boolean;
}
```

**Ações Automáticas:**
- Bloqueio temporário após 5 falhas de autenticação
- Solicitação de MFA adicional em transações suspeitas
- Notificação ao usuário de atividade incomum
- Bloqueio de conta em caso de fraude confirmada
- Alerta para equipe de segurança

### 4.6 Métricas de Sucesso do MVP

**Métricas de Adoção:**
- 1.000 usuários cadastrados em 3 meses
- 60% de taxa de ativação (completam onboarding)
- 40% de retenção em 30 dias
- 25% de retenção em 90 dias

**Métricas de Engajamento:**
- 70% dos usuários ativos registram transações semanalmente
- Média de 15 transações por usuário/mês
- 50% dos usuários criam pelo menos 1 meta
- 30% dos usuários usam interface conversacional

**Métricas de Qualidade:**
- NPS > 40
- Taxa de erro < 1%
- Tempo de resposta P95 < 2s
- Disponibilidade > 99.5%

**Métricas de Segurança:**
- 100% dos usuários com MFA ativo
- 0 incidentes de segurança críticos
- 80% de usuários com KYC aprovado em 7 dias
- 0 vazamentos de dados

**Métricas de Conformidade:**
- 100% de conformidade com LGPD
- < 24h para responder solicitações de dados
- < 7 dias para processar exclusões
- 0 reclamações regulatórias

---

## 5. Modelagem do Banco de Dados

### 5.1 Diagrama Entidade-Relacionamento (ERD)

```mermaid
erDiagram
    users ||--o{ transactions : creates
    users ||--o{ goals : defines
    users ||--o{ user_consents : has
    users ||--o{ user_sessions : has
    users ||--o{ product_events : generates
    transactions }o--|| categories : belongs_to
    goals ||--o{ goal_milestones : has

    users {
        uuid id PK
        string email UK
        string password_hash
        date birthdate
        boolean is_adult
        string kyc_status
        string kyc_document_hash
        timestamp kyc_verified_at
        boolean mfa_enabled
        string mfa_secret_encrypted
        jsonb consents
        timestamp created_at
        timestamp updated_at
        timestamp deleted_at
    }

    transactions {
        uuid id PK
        uuid user_id FK
        uuid category_id FK
        string type
        decimal amount
        date transaction_date
        string description
        text notes_encrypted
        string attachment_url
        timestamp created_at
        timestamp updated_at
    }

    categories {
        uuid id PK
        string name
        string type
        string icon
        string color
        boolean is_system
        uuid created_by FK
    }

    goals {
        uuid id PK
        uuid user_id FK
        string name
        decimal target_amount
        decimal current_amount
        date target_date
        string status
        timestamp created_at
        timestamp updated_at
    }

    goal_milestones {
        uuid id PK
        uuid goal_id FK
        integer percentage
        timestamp achieved_at
    }

    user_consents {
        uuid id PK
        uuid user_id FK
        string consent_type
        boolean granted
        timestamp granted_at
        timestamp revoked_at
        string ip_address
    }

    user_sessions {
        uuid id PK
        uuid user_id FK
        string refresh_token_hash
        string device_info
        string ip_address
        timestamp expires_at
        timestamp created_at
    }

    product_events {
        uuid id PK
        uuid user_id FK
        string event_type
        jsonb event_data
        string ip_address
        timestamp created_at
    }
```

### 5.2 DDL Completo com Comentários

```sql
-- =====================================================
-- FINAUTO DATABASE SCHEMA
-- Version: 1.0
-- Description: Schema completo para aplicativo de gestão financeira
-- =====================================================

-- Extensões necessárias
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "pgcrypto";

-- =====================================================
-- TABELA: users
-- Descrição: Armazena informações dos usuários
-- =====================================================
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    birthdate DATE NOT NULL,
    is_adult BOOLEAN NOT NULL DEFAULT false,
    kyc_status VARCHAR(20) NOT NULL DEFAULT 'pending' 
        CHECK (kyc_status IN ('pending', 'in_review', 'approved', 'rejected')),
    kyc_document_hash VARCHAR(64), -- SHA-256 hash
    kyc_verified_at TIMESTAMP WITH TIME ZONE,
    mfa_enabled BOOLEAN NOT NULL DEFAULT false,
    mfa_secret_encrypted TEXT, -- Criptografado com pgcrypto
    consents JSONB NOT NULL DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    deleted_at TIMESTAMP WITH TIME ZONE -- Soft delete
);

COMMENT ON TABLE users IS 'Tabela principal de usuários com validação de idade e KYC';
COMMENT ON COLUMN users.birthdate IS 'Data de nascimento para validação de maioridade';
COMMENT ON COLUMN users.is_adult IS 'Flag calculada automaticamente, true se >= 18 anos';
COMMENT ON COLUMN users.kyc_status IS 'Status do processo KYC: pending, in_review, approved, rejected';
COMMENT ON COLUMN users.kyc_document_hash IS 'Hash SHA-256 do documento, não armazena documento original';
COMMENT ON COLUMN users.mfa_secret_encrypted IS 'Secret TOTP criptografado com pgcrypto';
COMMENT ON COLUMN users.deleted_at IS 'Timestamp de soft delete para conformidade LGPD';

-- Índices
CREATE INDEX idx_users_email ON users(email) WHERE deleted_at IS NULL;
CREATE INDEX idx_users_kyc_status ON users(kyc_status) WHERE deleted_at IS NULL;
CREATE INDEX idx_users_created_at ON users(created_at);

-- =====================================================
-- TABELA: categories
-- Descrição: Categorias de transações (sistema e customizadas)
-- =====================================================
CREATE TABLE categories (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(100) NOT NULL,
    type VARCHAR(20) NOT NULL CHECK (type IN ('income', 'expense')),
    icon VARCHAR(50),
    color VARCHAR(7), -- Hex color code
    is_system BOOLEAN NOT NULL DEFAULT false,
    created_by UUID REFERENCES users(id) ON DELETE SET NULL,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);

COMMENT ON TABLE categories IS 'Categorias de transações, incluindo categorias do sistema e customizadas por usuário';
COMMENT ON COLUMN categories.is_system IS 'True para categorias padrão do sistema, false para customizadas';

-- Índices
CREATE INDEX idx_categories_type ON categories(type);
CREATE INDEX idx_categories_created_by ON categories(created_by);

-- =====================================================
-- TABELA: transactions
-- Descrição: Registro de todas as transações financeiras
-- =====================================================
CREATE TABLE transactions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    category_id UUID NOT NULL REFERENCES categories(id) ON DELETE RESTRICT,
    type VARCHAR(20) NOT NULL CHECK (type IN ('income', 'expense')),
    amount DECIMAL(15, 2) NOT NULL CHECK (amount > 0),
    transaction_date DATE NOT NULL,
    description VARCHAR(255) NOT NULL,
    notes_encrypted TEXT, -- Criptografado com pgcrypto
    attachment_url TEXT, -- URL no Supabase Storage
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);

COMMENT ON TABLE transactions IS 'Registro de receitas e despesas dos usuários';
COMMENT ON COLUMN transactions.notes_encrypted IS 'Notas adicionais criptografadas com pgcrypto';
COMMENT ON COLUMN transactions.attachment_url IS 'URL do comprovante armazenado no Supabase Storage com criptografia SSE';

-- Índices
CREATE INDEX idx_transactions_user_id ON transactions(user_id);
CREATE INDEX idx_transactions_user_date ON transactions(user_id, transaction_date DESC);
CREATE INDEX idx_transactions_category ON transactions(category_id);
CREATE INDEX idx_transactions_type ON transactions(type);

-- =====================================================
-- TABELA: goals
-- Descrição: Metas financeiras dos usuários
-- =====================================================
CREATE TABLE goals (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    name VARCHAR(255) NOT NULL,
    target_amount DECIMAL(15, 2) NOT NULL CHECK (target_amount > 0),
    current_amount DECIMAL(15, 2) NOT NULL DEFAULT 0 CHECK (current_amount >= 0),
    target_date DATE NOT NULL,
    status VARCHAR(20) NOT NULL DEFAULT 'active' 
        CHECK (status IN ('active', 'paused', 'completed', 'cancelled')),
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);

COMMENT ON TABLE goals IS 'Metas financeiras definidas pelos usuários';
COMMENT ON COLUMN goals.current_amount IS 'Valor atual economizado, atualizado automaticamente';

-- Índices
CREATE INDEX idx_goals_user_id ON goals(user_id);
CREATE INDEX idx_goals_status ON goals(status);
CREATE INDEX idx_goals_target_date ON goals(target_date);

-- =====================================================
-- TABELA: goal_milestones
-- Descrição: Marcos de progresso das metas (25%, 50%, 75%, 100%)
-- =====================================================
CREATE TABLE goal_milestones (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    goal_id UUID NOT NULL REFERENCES goals(id) ON DELETE CASCADE,
    percentage INTEGER NOT NULL CHECK (percentage IN (25, 50, 75, 100)),
    achieved_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    UNIQUE(goal_id, percentage)
);

COMMENT ON TABLE goal_milestones IS 'Registro de marcos alcançados nas metas financeiras';

-- Índices
CREATE INDEX idx_goal_milestones_goal_id ON goal_milestones(goal_id);

-- =====================================================
-- TABELA: user_consents
-- Descrição: Registro de consentimentos LGPD
-- =====================================================
CREATE TABLE user_consents (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    consent_type VARCHAR(50) NOT NULL 
        CHECK (consent_type IN ('essential_processing', 'marketing_communications', 
                                'data_analytics', 'third_party_sharing')),
    granted BOOLEAN NOT NULL,
    granted_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    revoked_at TIMESTAMP WITH TIME ZONE,
    ip_address INET NOT NULL,
    user_agent TEXT
);

COMMENT ON TABLE user_consents IS 'Auditoria de consentimentos LGPD com histórico completo';
COMMENT ON COLUMN user_consents.consent_type IS 'Tipo de consentimento: essential_processing (obrigatório), outros opcionais';

-- Índices
CREATE INDEX idx_user_consents_user_id ON user_consents(user_id);
CREATE INDEX idx_user_consents_type ON user_consents(consent_type);
CREATE INDEX idx_user_consents_granted_at ON user_consents(granted_at);

-- =====================================================
-- TABELA: user_sessions
-- Descrição: Sessões ativas dos usuários (refresh tokens)
-- =====================================================
CREATE TABLE user_sessions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    refresh_token_hash VARCHAR(64) NOT NULL, -- SHA-256 hash
    device_info JSONB,
    ip_address INET NOT NULL,
    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);

COMMENT ON TABLE user_sessions IS 'Sessões ativas com refresh tokens para autenticação';
COMMENT ON COLUMN user_sessions.refresh_token_hash IS 'Hash SHA-256 do refresh token, não armazena token original';

-- Índices
CREATE INDEX idx_user_sessions_user_id ON user_sessions(user_id);
CREATE INDEX idx_user_sessions_expires_at ON user_sessions(expires_at);

-- =====================================================
-- TABELA: product_events
-- Descrição: Auditoria de eventos do sistema
-- =====================================================
CREATE TABLE product_events (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID REFERENCES users(id) ON DELETE SET NULL,
    event_type VARCHAR(100) NOT NULL,
    event_data JSONB NOT NULL DEFAULT '{}'::jsonb,
    ip_address INET,
    user_agent TEXT,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);

COMMENT ON TABLE product_events IS 'Auditoria completa de eventos do sistema para segurança e conformidade';
COMMENT ON COLUMN product_events.event_type IS 'Tipo de evento: user_registered, login_success, kyc_submitted, transaction_created, etc.';

-- Índices
CREATE INDEX idx_product_events_user_id ON product_events(user_id);
CREATE INDEX idx_product_events_type ON product_events(event_type);
CREATE INDEX idx_product_events_created_at ON product_events(created_at DESC);

-- =====================================================
-- TRIGGERS
-- =====================================================

-- Trigger: Validação de idade
CREATE OR REPLACE FUNCTION check_user_age()
RETURNS TRIGGER AS $$
BEGIN
    IF NEW.birthdate IS NOT NULL THEN
        IF EXTRACT(YEAR FROM AGE(NEW.birthdate)) < 18 THEN
            RAISE EXCEPTION 'Usuário deve ter 18 anos ou mais. Serviço disponível apenas para maiores de idade.';
        END IF;
        NEW.is_adult := EXTRACT(YEAR FROM AGE(NEW.birthdate)) >= 18;
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER validate_user_age
BEFORE INSERT OR UPDATE ON users
FOR EACH ROW EXECUTE FUNCTION check_user_age();

-- Trigger: Atualizar updated_at
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_users_updated_at BEFORE UPDATE ON users
FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_transactions_updated_at BEFORE UPDATE ON transactions
FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_goals_updated_at BEFORE UPDATE ON goals
FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- Trigger: Auditar eventos críticos
CREATE OR REPLACE FUNCTION audit_critical_events()
RETURNS TRIGGER AS $$
BEGIN
    IF TG_OP = 'INSERT' THEN
        INSERT INTO product_events (user_id, event_type, event_data)
        VALUES (NEW.user_id, TG_TABLE_NAME || '_created', to_jsonb(NEW));
    ELSIF TG_OP = 'UPDATE' THEN
        INSERT INTO product_events (user_id, event_type, event_data)
        VALUES (NEW.user_id, TG_TABLE_NAME || '_updated', 
                jsonb_build_object('old', to_jsonb(OLD), 'new', to_jsonb(NEW)));
    ELSIF TG_OP = 'DELETE' THEN
        INSERT INTO product_events (user_id, event_type, event_data)
        VALUES (OLD.user_id, TG_TABLE_NAME || '_deleted', to_jsonb(OLD));
    END IF;
    RETURN NULL;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER audit_transactions AFTER INSERT OR UPDATE OR DELETE ON transactions
FOR EACH ROW EXECUTE FUNCTION audit_critical_events();

-- =====================================================
-- ROW LEVEL SECURITY (RLS)
-- =====================================================

-- Habilitar RLS em todas as tabelas de usuário
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE transactions ENABLE ROW LEVEL SECURITY;
ALTER TABLE goals ENABLE ROW LEVEL SECURITY;
ALTER TABLE goal_milestones ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_consents ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_sessions ENABLE ROW LEVEL SECURITY;
ALTER TABLE categories ENABLE ROW LEVEL SECURITY;

-- Políticas RLS para users
CREATE POLICY users_select_own ON users
    FOR SELECT
    USING (id = current_setting('finauto.auth_user_id')::uuid);

CREATE POLICY users_update_own ON users
    FOR UPDATE
    USING (id = current_setting('finauto.auth_user_id')::uuid);

-- Políticas RLS para transactions
CREATE POLICY transactions_all_own ON transactions
    FOR ALL
    USING (user_id = current_setting('finauto.auth_user_id')::uuid);

-- Políticas RLS para goals
CREATE POLICY goals_all_own ON goals
    FOR ALL
    USING (user_id = current_setting('finauto.auth_user_id')::uuid);

-- Políticas RLS para goal_milestones
CREATE POLICY goal_milestones_all_own ON goal_milestones
    FOR ALL
    USING (
        goal_id IN (
            SELECT id FROM goals 
            WHERE user_id = current_setting('finauto.auth_user_id')::uuid
        )
    );

-- Políticas RLS para user_consents
CREATE POLICY user_consents_all_own ON user_consents
    FOR ALL
    USING (user_id = current_setting('finauto.auth_user_id')::uuid);

-- Políticas RLS para user_sessions
CREATE POLICY user_sessions_all_own ON user_sessions
    FOR ALL
    USING (user_id = current_setting('finauto.auth_user_id')::uuid);

-- Políticas RLS para categories
CREATE POLICY categories_select_all ON categories
    FOR SELECT
    USING (is_system = true OR created_by = current_setting('finauto.auth_user_id')::uuid);

CREATE POLICY categories_insert_own ON categories
    FOR INSERT
    WITH CHECK (created_by = current_setting('finauto.auth_user_id')::uuid);

-- =====================================================
-- ROLES E PERMISSÕES (RBAC)
-- =====================================================

-- Role: finauto_admin (acesso total)
CREATE ROLE finauto_admin;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO finauto_admin;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO finauto_admin;

-- Role: finauto_service (backend services)
CREATE ROLE finauto_service;
GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA public TO finauto_service;
GRANT USAGE ON ALL SEQUENCES IN SCHEMA public TO finauto_service;

-- Role: finauto_app (aplicação frontend)
CREATE ROLE finauto_app;
GRANT SELECT, INSERT, UPDATE ON users, transactions, goals, goal_milestones, 
      user_consents, user_sessions, categories TO finauto_app;
GRANT USAGE ON ALL SEQUENCES IN SCHEMA public TO finauto_app;

-- Role: finauto_readonly (analytics, reports)
CREATE ROLE finauto_readonly;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO finauto_readonly;

-- =====================================================
-- FUNÇÕES AUXILIARES
-- =====================================================

-- Função: Calcular saldo do usuário
CREATE OR REPLACE FUNCTION calculate_user_balance(p_user_id UUID)
RETURNS DECIMAL(15, 2) AS $$
DECLARE
    v_balance DECIMAL(15, 2);
BEGIN
    SELECT 
        COALESCE(SUM(CASE WHEN type = 'income' THEN amount ELSE -amount END), 0)
    INTO v_balance
    FROM transactions
    WHERE user_id = p_user_id;
    
    RETURN v_balance;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

COMMENT ON FUNCTION calculate_user_balance IS 'Calcula saldo total do usuário (receitas - despesas)';

-- Função: Atualizar progresso da meta
CREATE OR REPLACE FUNCTION update_goal_progress(p_goal_id UUID)
RETURNS VOID AS $$
DECLARE
    v_user_id UUID;
    v_balance DECIMAL(15, 2);
    v_target DECIMAL(15, 2);
    v_percentage INTEGER;
BEGIN
    -- Buscar user_id e target da meta
    SELECT user_id, target_amount INTO v_user_id, v_target
    FROM goals WHERE id = p_goal_id;
    
    -- Calcular saldo atual
    v_balance := calculate_user_balance(v_user_id);
    
    -- Atualizar current_amount
    UPDATE goals SET current_amount = v_balance WHERE id = p_goal_id;
    
    -- Calcular percentual
    v_percentage := LEAST(100, (v_balance / v_target * 100)::INTEGER);
    
    -- Registrar milestones
    IF v_percentage >= 25 THEN
        INSERT INTO goal_milestones (goal_id, percentage)
        VALUES (p_goal_id, 25)
        ON CONFLICT (goal_id, percentage) DO NOTHING;
    END IF;
    
    IF v_percentage >= 50 THEN
        INSERT INTO goal_milestones (goal_id, percentage)
        VALUES (p_goal_id, 50)
        ON CONFLICT (goal_id, percentage) DO NOTHING;
    END IF;
    
    IF v_percentage >= 75 THEN
        INSERT INTO goal_milestones (goal_id, percentage)
        VALUES (p_goal_id, 75)
        ON CONFLICT (goal_id, percentage) DO NOTHING;
    END IF;
    
    IF v_percentage >= 100 THEN
        INSERT INTO goal_milestones (goal_id, percentage)
        VALUES (p_goal_id, 100)
        ON CONFLICT (goal_id, percentage) DO NOTHING;
        
        UPDATE goals SET status = 'completed' WHERE id = p_goal_id;
    END IF;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

COMMENT ON FUNCTION update_goal_progress IS 'Atualiza progresso da meta e registra milestones alcançados';

-- Função: Anonimizar usuário (LGPD)
CREATE OR REPLACE FUNCTION anonymize_user(p_user_id UUID)
RETURNS VOID AS $$
BEGIN
    UPDATE users SET
        email = 'deleted_' || id || '@anonymized.local',
        password_hash = 'DELETED',
        birthdate = '1900-01-01',
        kyc_document_hash = NULL,
        mfa_secret_encrypted = NULL,
        deleted_at = NOW()
    WHERE id = p_user_id;
    
    -- Manter transações agregadas mas remover detalhes sensíveis
    UPDATE transactions SET
        description = 'Transação anonimizada',
        notes_encrypted = NULL,
        attachment_url = NULL
    WHERE user_id = p_user_id;
    
    -- Registrar evento
    INSERT INTO product_events (user_id, event_type, event_data)
    VALUES (p_user_id, 'user_anonymized', jsonb_build_object('anonymized_at', NOW()));
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

COMMENT ON FUNCTION anonymize_user IS 'Anonimiza dados do usuário mantendo dados agregados para conformidade LGPD';

-- =====================================================
-- SEEDS: Categorias Padrão do Sistema
-- =====================================================

INSERT INTO categories (name, type, icon, color, is_system) VALUES
-- Receitas
('Salário', 'income', 'briefcase', '#10b981', true),
('Freelance', 'income', 'laptop', '#3b82f6', true),
('Investimentos', 'income', 'trending-up', '#8b5cf6', true),
('Outros', 'income', 'plus-circle', '#6b7280', true),

-- Despesas
('Alimentação', 'expense', 'utensils', '#ef4444', true),
('Transporte', 'expense', 'car', '#f59e0b', true),
('Moradia', 'expense', 'home', '#06b6d4', true),
('Saúde', 'expense', 'heart', '#ec4899', true),
('Educação', 'expense', 'book', '#8b5cf6', true),
('Lazer', 'expense', 'smile', '#10b981', true),
('Compras', 'expense', 'shopping-bag', '#f97316', true),
('Contas', 'expense', 'file-text', '#6366f1', true),
('Outros', 'expense', 'more-horizontal', '#6b7280', true);

-- =====================================================
-- VIEWS ÚTEIS
-- =====================================================

-- View: Resumo mensal por usuário
CREATE OR REPLACE VIEW monthly_summary AS
SELECT 
    user_id,
    DATE_TRUNC('month', transaction_date) as month,
    SUM(CASE WHEN type = 'income' THEN amount ELSE 0 END) as total_income,
    SUM(CASE WHEN type = 'expense' THEN amount ELSE 0 END) as total_expense,
    SUM(CASE WHEN type = 'income' THEN amount ELSE -amount END) as net_balance,
    COUNT(*) as transaction_count
FROM transactions
GROUP BY user_id, DATE_TRUNC('month', transaction_date);

COMMENT ON VIEW monthly_summary IS 'Resumo mensal de receitas, despesas e saldo por usuário';

-- View: Despesas por categoria
CREATE OR REPLACE VIEW expenses_by_category AS
SELECT 
    t.user_id,
    c.name as category_name,
    c.icon,
    c.color,
    SUM(t.amount) as total_amount,
    COUNT(*) as transaction_count,
    ROUND(SUM(t.amount) * 100.0 / SUM(SUM(t.amount)) OVER (PARTITION BY t.user_id), 2) as percentage
FROM transactions t
JOIN categories c ON t.category_id = c.id
WHERE t.type = 'expense'
GROUP BY t.user_id, c.name, c.icon, c.color;

COMMENT ON VIEW expenses_by_category IS 'Agregação de despesas por categoria com percentuais';
```

### 5.3 Justificativas de Índices

**Índices Criados e Justificativas:**

1. **idx_users_email**: Busca rápida por email no login (operação frequente)
2. **idx_users_kyc_status**: Filtrar usuários por status KYC para processos administrativos
3. **idx_users_created_at**: Análise de crescimento de usuários ao longo do tempo
4. **idx_transactions_user_id**: Buscar todas as transações de um usuário (operação mais frequente)
5. **idx_transactions_user_date**: Busca de transações por usuário ordenadas por data (dashboard)
6. **idx_transactions_category**: Agregações por categoria
7. **idx_goals_user_id**: Buscar metas de um usuário
8. **idx_goals_status**: Filtrar metas ativas/completadas
9. **idx_product_events_created_at**: Auditoria cronológica de eventos

**Índices Não Criados (Justificativa):**

- **transactions.amount**: Raramente filtrado diretamente, usado em agregações
- **goals.target_date**: Baixa cardinalidade, poucos filtros diretos
- **categories.name**: Tabela pequena (<100 registros), scan completo é rápido

### 5.4 Consultas SQL Principais

```sql
-- Query 1: Dashboard - Saldo e resumo do mês atual
SELECT 
    calculate_user_balance(:user_id) as current_balance,
    (SELECT SUM(amount) FROM transactions 
     WHERE user_id = :user_id 
     AND type = 'income' 
     AND DATE_TRUNC('month', transaction_date) = DATE_TRUNC('month', CURRENT_DATE)) as month_income,
    (SELECT SUM(amount) FROM transactions 
     WHERE user_id = :user_id 
     AND type = 'expense' 
     AND DATE_TRUNC('month', transaction_date) = DATE_TRUNC('month', CURRENT_DATE)) as month_expense,
    (SELECT COUNT(*) FROM transactions 
     WHERE user_id = :user_id 
     AND DATE_TRUNC('month', transaction_date) = DATE_TRUNC('month', CURRENT_DATE)) as month_transactions;

-- Query 2: Despesas por categoria (mês atual)
SELECT 
    c.name,
    c.icon,
    c.color,
    SUM(t.amount) as total,
    COUNT(*) as count,
    ROUND(SUM(t.amount) * 100.0 / (
        SELECT SUM(amount) FROM transactions 
        WHERE user_id = :user_id 
        AND type = 'expense'
        AND DATE_TRUNC('month', transaction_date) = DATE_TRUNC('month', CURRENT_DATE)
    ), 2) as percentage
FROM transactions t
JOIN categories c ON t.category_id = c.id
WHERE t.user_id = :user_id
AND t.type = 'expense'
AND DATE_TRUNC('month', t.transaction_date) = DATE_TRUNC('month', CURRENT_DATE)
GROUP BY c.id, c.name, c.icon, c.color
ORDER BY total DESC;

-- Query 3: Histórico de transações com paginação
SELECT 
    t.id,
    t.type,
    t.amount,
    t.transaction_date,
    t.description,
    c.name as category_name,
    c.icon as category_icon,
    c.color as category_color,
    t.created_at
FROM transactions t
JOIN categories c ON t.category_id = c.id
WHERE t.user_id = :user_id
ORDER BY t.transaction_date DESC, t.created_at DESC
LIMIT :limit OFFSET :offset;

-- Query 4: Progresso de metas
SELECT 
    g.id,
    g.name,
    g.target_amount,
    g.current_amount,
    g.target_date,
    g.status,
    ROUND((g.current_amount / g.target_amount * 100)::numeric, 2) as progress_percentage,
    CASE 
        WHEN g.target_date < CURRENT_DATE THEN 'overdue'
        WHEN g.target_date - CURRENT_DATE <= 30 THEN 'urgent'
        ELSE 'on_track'
    END as urgency,
    (SELECT COUNT(*) FROM goal_milestones WHERE goal_id = g.id) as milestones_achieved
FROM goals g
WHERE g.user_id = :user_id
AND g.status IN ('active', 'paused')
ORDER BY g.target_date ASC;

-- Query 5: Comparação mensal (últimos 6 meses)
SELECT 
    TO_CHAR(month, 'YYYY-MM') as month_label,
    total_income,
    total_expense,
    net_balance,
    transaction_count
FROM monthly_summary
WHERE user_id = :user_id
AND month >= DATE_TRUNC('month', CURRENT_DATE - INTERVAL '6 months')
ORDER BY month DESC;

-- Query 6: Auditoria de eventos críticos
SELECT 
    pe.event_type,
    pe.event_data,
    pe.ip_address,
    pe.created_at
FROM product_events pe
WHERE pe.user_id = :user_id
AND pe.event_type IN ('login_success', 'login_failed', 'kyc_submitted', 
                      'transaction_created', 'goal_completed', 'consent_revoked')
ORDER BY pe.created_at DESC
LIMIT 50;

-- Query 7: Verificar limites para usuários não verificados
SELECT 
    u.id,
    u.kyc_status,
    COUNT(t.id) as transaction_count,
    CASE 
        WHEN u.kyc_status != 'approved' AND COUNT(t.id) >= 10 THEN true
        ELSE false
    END as limit_reached
FROM users u
LEFT JOIN transactions t ON u.id = t.user_id 
    AND DATE_TRUNC('month', t.transaction_date) = DATE_TRUNC('month', CURRENT_DATE)
WHERE u.id = :user_id
GROUP BY u.id, u.kyc_status;
```

### 5.5 Estratégia de Migrações

**Estrutura de Migrações:**

```
/finauto-db
  /migrations
    001_initial_schema.sql
    002_add_indexes.sql
    003_add_triggers.sql
    004_add_rls_policies.sql
    005_add_roles.sql
    006_add_functions.sql
    007_add_views.sql
    008_seed_categories.sql
  /rollbacks
    001_rollback.sql
    002_rollback.sql
    ...
```

**Convenções:**

1. Migrações numeradas sequencialmente (001, 002, etc.)
2. Nomes descritivos da mudança
3. Cada migração deve ser idempotente quando possível
4. Sempre criar rollback correspondente
5. Testar migração e rollback antes de aplicar em produção
6. Manter changelog atualizado

**Exemplo de Migração:**

```sql
-- migrations/009_add_transaction_tags.sql
-- Description: Adiciona suporte a tags em transações
-- Author: Dev Team
-- Date: 2025-12-15

BEGIN;

-- Criar tabela de tags
CREATE TABLE IF NOT EXISTS transaction_tags (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    transaction_id UUID NOT NULL REFERENCES transactions(id) ON DELETE CASCADE,
    tag VARCHAR(50) NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    UNIQUE(transaction_id, tag)
);

-- Criar índice
CREATE INDEX IF NOT EXISTS idx_transaction_tags_transaction_id 
ON transaction_tags(transaction_id);

CREATE INDEX IF NOT EXISTS idx_transaction_tags_tag 
ON transaction_tags(tag);

-- Habilitar RLS
ALTER TABLE transaction_tags ENABLE ROW LEVEL SECURITY;

-- Criar política RLS
CREATE POLICY transaction_tags_all_own ON transaction_tags
    FOR ALL
    USING (
        transaction_id IN (
            SELECT id FROM transactions 
            WHERE user_id = current_setting('finauto.auth_user_id')::uuid
        )
    );

-- Registrar migração
INSERT INTO schema_migrations (version, description) 
VALUES ('009', 'Add transaction tags support');

COMMIT;
```

**Rollback Correspondente:**

```sql
-- rollbacks/009_rollback.sql
BEGIN;

DROP POLICY IF EXISTS transaction_tags_all_own ON transaction_tags;
DROP TABLE IF EXISTS transaction_tags CASCADE;
DELETE FROM schema_migrations WHERE version = '009';

COMMIT;
```

### 5.6 Performance e Otimização

**Metas de Performance:**

- Queries de dashboard: < 100ms (P95)
- Queries de listagem: < 200ms (P95)
- Inserções: < 50ms (P95)
- Atualizações: < 100ms (P95)

**Estratégias de Otimização:**

1. **Connection Pooling:**
   - Supabase Pooler configurado com 20 conexões
   - Timeout de conexão: 30s
   - Idle timeout: 10min

2. **Query Optimization:**
   - Uso de EXPLAIN ANALYZE para identificar gargalos
   - Evitar N+1 queries com JOINs apropriados
   - Uso de CTEs para queries complexas
   - Limit sempre que possível

3. **Caching:**
   - React Query no frontend (stale-while-revalidate)
   - Cache de categorias (raramente mudam)
   - Cache de saldo calculado (invalidar em transação)

4. **Particionamento (Futuro):**
   - Particionar `transactions` por ano quando > 1M registros
   - Particionar `product_events` por mês

5. **Vacuum e Analyze:**
   - Autovacuum habilitado
   - Analyze manual semanal em tabelas grandes

**Monitoramento de Performance:**

```sql
-- Query para identificar queries lentas
SELECT 
    query,
    calls,
    total_time,
    mean_time,
    max_time
FROM pg_stat_statements
WHERE mean_time > 100 -- queries com média > 100ms
ORDER BY mean_time DESC
LIMIT 20;

-- Query para identificar tabelas que precisam de vacuum
SELECT 
    schemaname,
    tablename,
    n_dead_tup,
    n_live_tup,
    ROUND(n_dead_tup * 100.0 / NULLIF(n_live_tup + n_dead_tup, 0), 2) as dead_percentage
FROM pg_stat_user_tables
WHERE n_dead_tup > 1000
ORDER BY dead_percentage DESC;
```

---

## 6. Design de Interface (UX/UI)

### 6.1 Princípios de Design

1. **Simplicidade**: Interface limpa, sem elementos desnecessários
2. **Clareza**: Linguagem simples, sem jargões financeiros
3. **Feedback**: Resposta imediata a todas as ações
4. **Consistência**: Padrões visuais e de interação uniformes
5. **Acessibilidade**: WCAG 2.1 AA, navegação por teclado, leitores de tela
6. **Educação**: Mensagens educativas sem indução financeira
7. **Confiança**: Transparência sobre dados e segurança

### 6.2 Telas Principais

#### 6.2.1 Tela de Cadastro

**Elementos Essenciais:**
- Logo do FinAuto
- Título: "Comece a organizar suas finanças"
- Campos:
  - Email (com validação)
  - Senha (com indicador de força)
  - Data de nascimento (com validação de idade)
  - Checkbox de consentimentos LGPD
- Botão "Criar conta"
- Link "Já tem conta? Entrar"

**Validações e Feedbacks:**
- Validação em tempo real de email
- Indicador visual de força da senha
- Cálculo automático de idade
- Bloqueio com mensagem clara se < 18 anos
- Tooltip explicativo sobre cada consentimento
- Loading state no botão durante criação

**Mensagem de Bloqueio (< 18 anos):**
```
❌ Idade mínima não atendida

O FinAuto é um serviço exclusivo para maiores de 18 anos.

Isso garante que possamos oferecer funcionalidades financeiras 
de forma responsável e em conformidade com a legislação.

Volte quando completar 18 anos! 🎂
```

**Acessibilidade:**
- Labels visíveis em todos os campos
- Aria-labels descritivos
- Ordem de tabulação lógica
- Mensagens de erro anunciadas por leitores de tela
- Contraste mínimo 4.5:1

#### 6.2.2 Tela de Login

**Elementos Essenciais:**
- Logo do FinAuto
- Título: "Bem-vindo de volta!"
- Campos:
  - Email
  - Senha (com toggle show/hide)
- Checkbox "Lembrar-me"
- Botão "Entrar"
- Link "Esqueci minha senha"
- Link "Criar conta"

**Fluxo MFA:**
1. Após credenciais corretas, exibir campo de código MFA
2. Título: "Verificação em duas etapas"
3. Subtítulo: "Digite o código do seu aplicativo autenticador"
4. Campo numérico de 6 dígitos
5. Link "Não consigo acessar meu código"
6. Botão "Verificar"

**Feedbacks de Erro:**
- "Email ou senha incorretos" (não especificar qual)
- "Código MFA inválido. Tente novamente."
- "Muitas tentativas. Conta bloqueada temporariamente por 15 minutos."

#### 6.2.3 Tela de KYC

**Elementos Essenciais:**
- Progresso visual (3 etapas)
- Título: "Verificação de identidade"
- Subtítulo educativo: "Isso garante a segurança da sua conta"

**Etapa 1 - Documento:**
- Seletor de tipo: CPF ou RG
- Campo de número do documento
- Botão "Continuar"

**Etapa 2 - Selfie:**
- Instruções visuais
- Botão "Tirar foto" (acesso à câmera)
- Preview da foto
- Botão "Usar esta foto" ou "Tirar novamente"

**Etapa 3 - Revisão:**
- Resumo dos dados enviados
- Checkbox: "Confirmo que as informações são verdadeiras"
- Botão "Enviar para verificação"

**Estados de KYC:**
- **Pending**: "Verificação pendente. Complete agora para liberar todas as funcionalidades."
- **In Review**: "Sua verificação está em análise. Isso pode levar até 24 horas."
- **Approved**: "✅ Conta verificada! Todas as funcionalidades liberadas."
- **Rejected**: "❌ Verificação não aprovada. Tente novamente com documentos mais claros."

#### 6.2.4 Dashboard (Tela Principal)

**Layout:**
```
┌─────────────────────────────────────────┐
│ Header: Logo | Notificações | Perfil   │
├─────────────────────────────────────────┤
│ Saldo Atual                             │
│ R$ 2.450,00                             │
│ ↑ +15% vs mês passado                   │
├─────────────────────────────────────────┤
│ Resumo do Mês                           │
│ ┌──────────┬──────────┐                │
│ │ Receitas │ Despesas │                │
│ │ R$ 3.500 │ R$ 1.050 │                │
│ └──────────┴──────────┘                │
├─────────────────────────────────────────┤
│ Gastos por Categoria                    │
│ [Gráfico de Pizza Interativo]          │
├─────────────────────────────────────────┤
│ Metas Ativas                            │
│ ┌─────────────────────────────────────┐│
│ │ 🎯 Viagem                           ││
│ │ R$ 1.200 / R$ 3.000 (40%)          ││
│ │ [Barra de Progresso]               ││
│ └─────────────────────────────────────┘│
├─────────────────────────────────────────┤
│ Ações Rápidas                           │
│ [+ Adicionar] [📊 Ver Tudo] [🎯 Metas] │
└─────────────────────────────────────────┘
```

**Elementos Interativos:**
- Card de saldo com animação ao atualizar
- Gráfico de pizza com hover mostrando valores
- Cards de metas clicáveis para detalhes
- Botões de ação rápida com ícones

**Microfeedbacks:**
- Skeleton loading durante carregamento
- Animação de atualização de valores
- Confetti ao atingir milestone de meta
- Toast notifications para ações concluídas

#### 6.2.5 Interface Conversacional

**Layout:**
```
┌─────────────────────────────────────────┐
│ Assistente FinAuto                      │
├─────────────────────────────────────────┤
│                                         │
│  Bot: Olá! Como posso ajudar?          │
│  [Avatar]                               │
│                                         │
│              Você: Gastei 50 reais     │
│              no almoço hoje            │
│              [Avatar]                   │
│                                         │
│  Bot: Entendi! Você gastou R$ 50,00    │
│  [Avatar] em alimentação hoje.          │
│       Está correto?                     │
│       [✓ Sim] [✗ Não, corrigir]        │
│                                         │
└─────────────────────────────────────────┘
│ [Digite ou fale...] [🎤] [📎]          │
└─────────────────────────────────────────┘
```

**Capacidades:**
- Reconhecimento de intenções: adicionar receita/despesa, consultar saldo, criar meta
- Extração de entidades: valor, data, categoria, descrição
- Confirmação antes de salvar
- Sugestões de ações: "Você também pode..."
- Fallback para formulário: "Prefere preencher um formulário?"

**Exemplos de Diálogos:**

**Adicionar Despesa:**
```
Você: Paguei 120 reais na conta de luz
Bot: Registrei uma despesa de R$ 120,00 em "Contas" 
     para hoje. Tudo certo?
     [✓ Confirmar] [✗ Corrigir]
```

**Consultar Saldo:**
```
Você: Quanto tenho disponível?
Bot: Seu saldo atual é R$ 2.450,00.
     Este mês você recebeu R$ 3.500,00 e gastou R$ 1.050,00.
     [Ver detalhes] [Adicionar transação]
```

**Criar Meta:**
```
Você: Quero juntar 3 mil reais para uma viagem
Bot: Legal! Vamos criar uma meta de R$ 3.000,00 para viagem.
     Até quando você quer alcançar?
Você: Até dezembro
Bot: Perfeito! Meta criada: R$ 3.000,00 até 31/12/2025.
     Você precisa economizar cerca de R$ 500,00 por mês.
     [Ver meta] [Voltar ao dashboard]
```

#### 6.2.6 Planilha de Transações

**Layout:**
```
┌─────────────────────────────────────────────────────────┐
│ Transações                                   [+ Adicionar]│
├─────────────────────────────────────────────────────────┤
│ Filtros: [Todas ▾] [Este mês ▾] [Todas categorias ▾]   │
│ Buscar: [                                    ] [🔍]     │
├──────┬──────────┬────────┬─────────┬──────────┬────────┤
│ Data │ Descrição│Categoria│  Valor  │   Tipo   │ Ações │
├──────┼──────────┼────────┼─────────┼──────────┼────────┤
│08/12 │Almoço    │🍽️ Alim.│ R$ 50,00│ Despesa  │[⋮]    │
│07/12 │Salário   │💼 Sal. │R$3.500  │ Receita  │[⋮]    │
│06/12 │Uber      │🚗 Trans│ R$ 25,00│ Despesa  │[⋮]    │
└──────┴──────────┴────────┴─────────┴──────────┴────────┘
│ Mostrando 3 de 45 transações        [1] 2 3 4 › »      │
└─────────────────────────────────────────────────────────┘
```

**Funcionalidades:**
- Filtros múltiplos (data, categoria, tipo)
- Busca por descrição
- Ordenação por colunas
- Paginação
- Menu de ações (editar, excluir, ver detalhes)
- Exportar para CSV (apenas usuários verificados)

**Detalhes de Transação (Modal):**
- Valor e tipo
- Data
- Categoria
- Descrição completa
- Notas (se houver)
- Comprovante (se houver)
- Botões: [Editar] [Excluir] [Fechar]

#### 6.2.7 Gerenciamento de Metas

**Layout de Lista:**
```
┌─────────────────────────────────────────┐
│ Minhas Metas                [+ Nova Meta]│
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐ │
│ │ 🎯 Viagem de Férias                 │ │
│ │ R$ 1.200 / R$ 3.000 (40%)          │ │
│ │ [████████░░░░░░░░░░]                │ │
│ │ Prazo: 31/12/2025 (23 dias)        │ │
│ │ Status: No prazo ✓                  │ │
│ │ [Ver detalhes]                      │ │
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ 💰 Fundo de Emergência              │ │
│ │ R$ 5.000 / R$ 10.000 (50%)         │ │
│ │ [██████████░░░░░░░░░░]              │ │
│ │ Prazo: 30/06/2026 (204 dias)       │ │
│ │ Status: No prazo ✓                  │ │
│ │ [Ver detalhes]                      │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

**Detalhes da Meta:**
- Nome e ícone
- Valor alvo e atual
- Progresso visual (barra + percentual)
- Data de criação e prazo
- Projeção de alcance
- Milestones alcançados (25%, 50%, 75%, 100%)
- Histórico de contribuições
- Botões: [Pausar] [Editar] [Excluir] [Voltar]

**Criar Nova Meta (Modal):**
- Campo: Nome da meta
- Campo: Valor alvo (R$)
- Campo: Data limite
- Seletor de ícone
- Botão "Criar meta"
- Mensagem educativa: "Dica: Metas realistas são mais fáceis de alcançar!"

#### 6.2.8 Configurações e Privacidade

**Seções:**

**1. Perfil:**
- Email (não editável)
- Data de nascimento (não editável)
- Status KYC
- Botão "Alterar senha"

**2. Segurança:**
- MFA: [Ativado ✓] [Gerenciar]
- Sessões ativas: Lista de dispositivos com [Encerrar]
- Botão "Encerrar todas as sessões"

**3. Privacidade (LGPD):**
- Consentimentos:
  - ☑ Processamento essencial (obrigatório, não editável)
  - ☐ Comunicações de marketing [Toggle]
  - ☐ Análise de dados [Toggle]
- Botão "Exportar meus dados"
- Botão "Excluir minha conta" (vermelho)

**4. Notificações:**
- ☑ Alertas de gastos acima da média
- ☑ Progresso de metas
- ☑ Lembretes de registro
- ☐ Newsletter mensal

**5. Aparência:**
- Tema: [Claro] [Escuro] [Sistema]
- Tamanho da fonte: [Pequeno] [Médio] [Grande]

**Fluxo de Exclusão de Conta:**
1. Clicar "Excluir minha conta"
2. Modal de confirmação:
   ```
   ⚠️ Atenção: Esta ação é irreversível
   
   Ao excluir sua conta:
   • Todos os seus dados serão anonimizados
   • Você perderá acesso a todas as transações
   • Suas metas serão excluídas
   • Não será possível recuperar sua conta
   
   Para confirmar, digite: EXCLUIR
   [                    ]
   
   [Cancelar] [Confirmar Exclusão]
   ```
3. Solicitar MFA
4. Processar anonimização
5. Logout automático
6. Mensagem: "Sua conta foi excluída. Sentiremos sua falta!"

### 6.3 Mensagens Educativas

**Princípios:**
- Linguagem simples e amigável
- Foco em educação, não em indução
- Contextual e oportuna
- Não invasiva

**Exemplos:**

**Ao criar primeira transação:**
```
💡 Dica: Registrar suas transações regularmente 
   ajuda você a entender melhor seus hábitos de gasto!
```

**Ao atingir 50% de uma meta:**
```
🎉 Parabéns! Você já está na metade do caminho!
   Continue assim e você alcançará sua meta em breve.
```

**Ao gastar acima da média:**
```
📊 Observação: Seus gastos este mês estão 20% acima 
   da média. Revise suas despesas para manter o controle.
   [Ver detalhes]
```

**Ao criar conta:**
```
🔒 Sua segurança é nossa prioridade!
   Ativamos autenticação em duas etapas para proteger 
   sua conta. Você precisará do código do app autenticador 
   sempre que fizer login.
```

### 6.4 Alertas para Ações Sensíveis

**Tipos de Alertas:**

1. **Exclusão de Transação:**
   ```
   ⚠️ Excluir transação?
   
   Esta ação não pode ser desfeita.
   A transação será removida permanentemente.
   
   [Cancelar] [Excluir]
   ```

2. **Alteração de Senha:**
   ```
   🔐 Alterar senha
   
   Por segurança, você será desconectado de todos 
   os dispositivos após alterar sua senha.
   
   Senha atual: [        ]
   Nova senha: [        ]
   Confirmar: [        ]
   
   [Cancelar] [Alterar Senha]
   ```

3. **Revogação de Consentimento:**
   ```
   ℹ️ Revogar consentimento
   
   Ao revogar este consentimento, você não receberá 
   mais comunicações de marketing. Você pode reativá-lo 
   a qualquer momento.
   
   [Cancelar] [Revogar]
   ```

4. **Desativação de MFA:**
   ```
   ⚠️ Desativar autenticação em duas etapas?
   
   Isso tornará sua conta menos segura.
   Recomendamos manter o MFA ativado.
   
   Para confirmar, digite sua senha:
   [                    ]
   
   [Cancelar] [Desativar]
   ```

### 6.5 Acessibilidade (WCAG 2.1 AA)

**Requisitos Implementados:**

1. **Perceptível:**
   - Contraste mínimo 4.5:1 (texto normal)
   - Contraste mínimo 3:1 (texto grande)
   - Textos alternativos em todas as imagens
   - Legendas em vídeos (se houver)
   - Informação não transmitida apenas por cor

2. **Operável:**
   - Navegação completa por teclado
   - Ordem de tabulação lógica
   - Foco visível em todos os elementos interativos
   - Sem armadilhas de teclado
   - Tempo suficiente para ler e usar conteúdo

3. **Compreensível:**
   - Linguagem simples (nível fundamental)
   - Instruções claras
   - Mensagens de erro específicas e acionáveis
   - Comportamento consistente
   - Prevenção de erros em ações críticas

4. **Robusto:**
   - HTML semântico
   - ARIA labels onde necessário
   - Compatibilidade com leitores de tela (NVDA, JAWS)
   - Testes com ferramentas automatizadas (axe, Lighthouse)

**Atalhos de Teclado:**
- `Alt + D`: Ir para Dashboard
- `Alt + T`: Ir para Transações
- `Alt + M`: Ir para Metas
- `Alt + C`: Abrir Chat
- `Alt + S`: Ir para Configurações
- `Esc`: Fechar modal/diálogo
- `Enter`: Confirmar ação
- `Tab`: Navegar para próximo elemento
- `Shift + Tab`: Navegar para elemento anterior

---

## 7. Recursos Necessários

### 7.1 Equipe Mínima

**Fase de Desenvolvimento (10 semanas):**

1. **Product Manager (1)** - 40h/semana
   - Refinamento de requisitos
   - Priorização de backlog
   - Comunicação com stakeholders
   - Validação de entregas

2. **Tech Lead / Arquiteto (1)** - 40h/semana
   - Arquitetura do sistema
   - Revisão de código
   - Decisões técnicas
   - Mentoria do time

3. **Full-Stack Developers (2)** - 40h/semana cada
   - Desenvolvimento frontend (React + TypeScript)
   - Desenvolvimento backend (Supabase + Edge Functions)
   - Integração de APIs
   - Testes unitários e integração

4. **UX/UI Designer (1)** - 20h/semana
   - Design de interfaces
   - Prototipagem
   - Design system
   - Testes de usabilidade

5. **QA Engineer (1)** - 40h/semana
   - Testes manuais e automatizados
   - Testes de segurança
   - Testes de acessibilidade
   - Documentação de bugs

6. **DevOps Engineer (1)** - 20h/semana
   - Configuração de infraestrutura
   - CI/CD
   - Monitoramento
   - Segurança

**Fase de Operação (pós-lançamento):**

1. **Product Manager (1)** - 20h/semana
2. **Full-Stack Developer (1)** - 40h/semana
3. **Customer Support (1)** - 40h/semana
4. **DevOps Engineer (1)** - 10h/semana (on-call)

### 7.2 Infraestrutura e Ferramentas

**Desenvolvimento:**
- **Supabase** (Plano Pro): $25/mês
  - PostgreSQL gerenciado
  - Authentication
  - Storage
  - Edge Functions
  - Realtime

- **Vercel** (Plano Pro): $20/mês
  - Hospedagem frontend
  - CI/CD automático
  - Preview deployments
  - Analytics

- **GitHub** (Plano Team): $4/usuário/mês
  - Repositório privado
  - GitHub Actions (CI/CD)
  - Project management

- **OpenAI API**: ~$100/mês (estimado)
  - GPT-4 para interface conversacional
  - ~10.000 requisições/mês

**Monitoramento e Observabilidade:**
- **Sentry** (Plano Team): $26/mês
  - Error tracking
  - Performance monitoring

- **LogRocket** (Plano Team): $99/mês
  - Session replay
  - Frontend monitoring

- **Datadog** (Plano Pro): $15/host/mês
  - Infrastructure monitoring
  - APM
  - Logs

**Segurança:**
- **Serviço KYC** (ex: Serpro): ~R$ 2/verificação
  - Estimativa: 500 verificações/mês = R$ 1.000/mês

- **Cloudflare** (Plano Pro): $20/mês
  - WAF
  - DDoS protection
  - CDN

**Comunicação:**
- **Slack** (Plano Pro): $7.25/usuário/mês
- **Figma** (Plano Professional): $12/editor/mês

**Custo Total Mensal (Desenvolvimento):**
- Infraestrutura: ~$400/mês
- Equipe (7 pessoas, média $5.000/mês): $35.000/mês
- **Total: ~$35.400/mês**

**Custo Total Mensal (Operação):**
- Infraestrutura: ~$400/mês
- Equipe (2.5 pessoas, média $5.000/mês): $12.500/mês
- **Total: ~$12.900/mês**

### 7.3 Integrações Externas

**Obrigatórias (MVP):**
1. **Supabase**: Backend completo
2. **OpenAI API**: Interface conversacional
3. **Serviço KYC**: Verificação de identidade (Serpro, Serasa, ou similar)
4. **Email Service**: Transacional (Supabase Auth ou SendGrid)

**Opcionais (Pós-MVP):**
1. **Open Banking**: Integração bancária automática
2. **SMS Gateway**: MFA via SMS (Twilio)
3. **Analytics**: Google Analytics ou Mixpanel
4. **Push Notifications**: OneSignal ou Firebase

---

## 8. Estratégia de Validação

### 8.1 Público-Alvo

**Perfil Primário:**
- **Idade**: 18-35 anos
- **Escolaridade**: Ensino médio completo ou superior
- **Renda**: R$ 1.500 - R$ 5.000/mês
- **Experiência Financeira**: Iniciante (pouca ou nenhuma educação financeira formal)
- **Comportamento**: 
  - Usa smartphone diariamente
  - Confortável com apps
  - Busca simplicidade
  - Preocupado com segurança de dados

**Personas:**

**Persona 1: Ana, 24 anos, Assistente Administrativa**
- Recém-formada, primeiro emprego formal
- Salário: R$ 2.500/mês
- Dificuldade em controlar gastos
- Quer economizar para viagem
- Usa Instagram e TikTok
- Preocupada com privacidade

**Persona 2: Carlos, 30 anos, Freelancer**
- Renda variável (R$ 3.000-R$ 6.000/mês)
- Dificuldade em planejar com renda irregular
- Quer criar fundo de emergência
- Tecnicamente confortável
- Valoriza autonomia e controle

**Persona 3: Juliana, 28 anos, Professora**
- Salário: R$ 3.500/mês
- Quer sair de dívidas
- Busca educação financeira
- Prefere interfaces simples
- Valoriza suporte e orientação

### 8.2 Linguagem e Comunicação

**Princípios:**
- **Simplicidade**: Nível de leitura fundamental (6º-8º ano)
- **Clareza**: Frases curtas, diretas
- **Amigabilidade**: Tom conversacional, não corporativo
- **Inclusividade**: Evitar jargões, explicar termos técnicos
- **Positividade**: Foco em conquistas, não em falhas

**Glossário Simplificado:**
- ❌ "Fluxo de caixa" → ✅ "Entradas e saídas de dinheiro"
- ❌ "Liquidez" → ✅ "Dinheiro disponível"
- ❌ "Alocação de recursos" → ✅ "Como você divide seu dinheiro"
- ❌ "ROI" → ✅ "Retorno do investimento"
- ❌ "Amortização" → ✅ "Pagamento de dívida"

**Exemplos de Textos:**

**Ruim:**
```
"Otimize sua alocação de recursos através de análise 
preditiva de fluxo de caixa e gestão de passivos."
```

**Bom:**
```
"Organize seu dinheiro de forma simples. 
Veja para onde vai cada real e planeje melhor."
```

### 8.3 Coleta Mínima de Dados

**Dados Coletados (Justificativa):**

**Obrigatórios:**
1. **Email**: Autenticação e comunicação essencial
2. **Senha**: Autenticação
3. **Data de Nascimento**: Validação de idade (requisito legal)
4. **Documento (hash)**: KYC e conformidade
5. **Transações**: Funcionalidade core do app
6. **Metas**: Funcionalidade core do app

**Opcionais (com consentimento explícito):**
1. **Nome**: Personalização (não obrigatório)
2. **Telefone**: MFA via SMS (alternativa ao TOTP)
3. **Foto de perfil**: Personalização

**NÃO Coletamos:**
- Dados bancários (sem integração no MVP)
- Localização precisa
- Contatos
- Dados de outros apps
- Histórico de navegação fora do app

**Transparência:**
- Política de privacidade em linguagem simples
- Explicação do uso de cada dado no momento da coleta
- Dashboard de privacidade mostrando todos os dados coletados
- Exportação completa disponível a qualquer momento

### 8.4 Sem Recomendações Financeiras

**Princípio:**
O FinAuto é uma ferramenta de organização, não um consultor financeiro.

**O que NÃO fazemos:**
- ❌ Recomendar investimentos específicos
- ❌ Sugerir produtos financeiros (cartões, empréstimos, etc.)
- ❌ Prever retornos financeiros
- ❌ Dar conselhos sobre dívidas
- ❌ Recomendar corte de gastos específicos

**O que fazemos:**
- ✅ Mostrar dados objetivos (quanto gastou, em quê)
- ✅ Comparar com períodos anteriores
- ✅ Alertar sobre gastos acima da média pessoal
- ✅ Fornecer conteúdo educativo genérico
- ✅ Ajudar a definir e acompanhar metas

**Exemplos:**

**Ruim (Recomendação):**
```
"Você deveria investir R$ 500 em Tesouro Direto 
para obter 10% de retorno anual."
```

**Bom (Informação):**
```
"Você economizou R$ 500 este mês! 
Considere definir uma meta para esse dinheiro."
```

**Ruim (Recomendação):**
```
"Corte seus gastos com alimentação em 30% 
para economizar mais."
```

**Bom (Informação):**
```
"Você gastou 40% do seu orçamento com alimentação 
este mês, acima da sua média de 30%."
```

**Disclaimer Obrigatório:**
```
ℹ️ O FinAuto é uma ferramenta de organização financeira.
   Não fornecemos consultoria ou recomendações de investimento.
   Para decisões financeiras importantes, consulte um 
   profissional certificado.
```

### 8.5 Testes de Validação

**Fase 1: Testes Internos (Semana 9)**
- Equipe interna usa o app diariamente
- Identificar bugs críticos
- Validar fluxos principais
- Testar em diferentes dispositivos

**Fase 2: Beta Fechado (Semana 10)**
- 20-30 usuários selecionados
- Perfis diversos (idade, renda, experiência)
- Sessões de observação (5 usuários)
- Questionário pós-uso:
  - Facilidade de uso (1-5)
  - Clareza das informações (1-5)
  - Confiança na segurança (1-5)
  - Probabilidade de recomendar (NPS)
  - Feedback aberto

**Fase 3: Beta Público (Semanas 11-12)**
- 100-200 usuários
- Monitoramento de métricas:
  - Taxa de ativação
  - Tempo médio de uso
  - Transações por usuário
  - Taxa de retenção D7
- Coleta de feedback via in-app surveys
- Análise de sessões (LogRocket)

**Critérios de Sucesso para Lançamento:**
- ✅ Taxa de ativação > 60%
- ✅ NPS > 40
- ✅ 0 bugs críticos
- ✅ Tempo de resposta P95 < 2s
- ✅ 100% de conformidade WCAG 2.1 AA
- ✅ Aprovação em penetration test

---

## 9. Roadmap de Desenvolvimento

### 9.1 Cronograma Detalhado

```mermaid
gantt
    title Roadmap FinAuto MVP
    dateFormat  YYYY-MM-DD
    section Fase 1: Fundação
    Infraestrutura Base           :2025-12-09, 5d
    Banco de Dados e Segurança    :2025-12-14, 5d
    Autenticação e KYC            :2025-12-19, 5d
    section Fase 2: Core
    Registro de Transações        :2025-12-24, 5d
    Interface Conversacional      :2025-12-29, 5d
    Dashboard                     :2026-01-03, 5d
    section Fase 3: Metas e LGPD
    Gerenciamento de Metas        :2026-01-08, 5d
    Conformidade LGPD             :2026-01-13, 5d
    section Fase 4: Polimento
    UX e Acessibilidade           :2026-01-18, 5d
    Testes e Observabilidade      :2026-01-23, 5d
    Documentação e Deploy         :2026-01-28, 5d
    section Validação
    Testes Internos               :2026-02-02, 5d
    Beta Fechado                  :2026-02-07, 5d
    Beta Público                  :2026-02-12, 10d
```

### 9.2 Marcos Principais

**Marco 1: Fundação Completa (Semana 3)**
- ✅ Infraestrutura configurada
- ✅ Banco de dados seguro
- ✅ Autenticação com MFA
- ✅ KYC funcional

**Marco 2: MVP Funcional (Semana 6)**
- ✅ Registro de transações
- ✅ Interface conversacional
- ✅ Dashboard visual
- ✅ Performance adequada

**Marco 3: Conformidade Total (Semana 8)**
- ✅ Sistema de metas
- ✅ LGPD implementada
- ✅ Controle de dados pelo usuário

**Marco 4: Pronto para Lançamento (Semana 10)**
- ✅ UX polida
- ✅ Testes completos
- ✅ Documentação finalizada
- ✅ Deploy em produção

**Marco 5: Validado (Semana 12)**
- ✅ Beta público concluído
- ✅ Métricas de sucesso atingidas
- ✅ Feedback incorporado

### 9.3 Pós-MVP (Roadmap Futuro)

**Q1 2026 (Meses 4-6):**
- Relatórios mensais automatizados
- Exportação de dados (CSV, PDF)
- Categorização inteligente com ML
- Notificações push
- App mobile nativo (iOS/Android)

**Q2 2026 (Meses 7-9):**
- Integração Open Banking
- Importação automática de transações
- Reconciliação bancária
- Modo família/compartilhamento
- Orçamento por categoria

**Q3 2026 (Meses 10-12):**
- Gamificação (badges, desafios)
- Comunidade (fóruns, grupos)
- Conteúdo educativo (artigos, vídeos)
- Parcerias com instituições financeiras
- Programa de afiliados

---

## 10. Requisitos de Conformidade (Regras A-J)

### 10.1 Regra A: Idade, KYC e Consentimentos

**Implementação:**
- ✅ Campo `birthdate` obrigatório no cadastro
- ✅ Campo `is_adult` calculado automaticamente
- ✅ Campo `kyc_status` com 4 estados
- ✅ Limites para contas não verificadas (10 transações/mês)
- ✅ MFA obrigatório para todos os usuários
- ✅ Sistema antifraude com regras automáticas
- ✅ Auditoria completa via `product_events`

**Validação:**
- Trigger SQL bloqueia menores de 18 anos
- Frontend valida antes de enviar
- Backend valida novamente
- Testes automatizados cobrem todos os casos

### 10.2 Regra B: SQL Obrigatório

**Implementação:**
- ✅ Campos `birthdate`, `is_adult`, `kyc_status` na tabela `users`
- ✅ Trigger `validate_user_age` bloqueia menores
- ✅ Extensão `pgcrypto` habilitada
- ✅ Colunas `notes_encrypted`, `mfa_secret_encrypted` com criptografia
- ✅ Hashes SHA-256 para documentos e tokens

**Código:**
```sql
-- Já incluído na seção 5.2 (DDL Completo)
```

### 10.3 Regra C: RBAC e RLS

**Implementação:**
- ✅ 4 roles: `finauto_admin`, `finauto_service`, `finauto_app`, `finauto_readonly`
- ✅ RLS habilitado em todas as tabelas de usuário
- ✅ Políticas usando `current_setting('finauto.auth_user_id')`
- ✅ Least privilege em todos os níveis

**Validação:**
- Testes de acesso entre usuários
- Tentativa de bypass de RLS
- Auditoria de permissões

### 10.4 Regra D: Criptografia e PII

**Implementação:**
- ✅ TLS 1.3 obrigatório (Supabase + Vercel)
- ✅ Discos encriptados (Supabase managed)
- ✅ pgcrypto para notas e documentos
- ✅ Hash SHA-256 para documentos
- ✅ Supabase Storage com SSE
- ✅ Chaves no KMS (Supabase Vault)

**Dados Criptografados:**
- Senhas (bcrypt)
- MFA secrets (pgcrypto)
- Notas de transações (pgcrypto)
- Documentos KYC (apenas hash armazenado)
- Refresh tokens (hash SHA-256)

### 10.5 Regra E: .env.example + Docker Compose

**Implementação:**
- ✅ `.env.example` com todas as variáveis documentadas
- ✅ `docker-compose.yml` para desenvolvimento local
- ✅ Secrets nunca commitados
- ✅ `.gitignore` configurado corretamente

**Arquivo `.env.example`:**
```bash
# Supabase
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Database
DATABASE_URL=postgresql://postgres:password@localhost:5432/finauto

# OpenAI
OPENAI_API_KEY=sk-...

# JWT
JWT_SECRET=your-jwt-secret-min-32-chars

# Environment
NODE_ENV=development
```

**Docker Compose:**
```yaml
version: '3.8'
services:
  postgres:
    image: postgres:14
    environment:
      POSTGRES_DB: finauto
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
  
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - SUPABASE_URL=${SUPABASE_URL}
    depends_on:
      - postgres

volumes:
  postgres_data:
```

### 10.6 Regra F: Segurança da Aplicação

**Implementação:**
- ✅ Senhas com bcrypt (cost factor 12)
- ✅ JWT curto (15 min) + refresh tokens
- ✅ MFA obrigatório (TOTP)
- ✅ Rate limiting (100 req/min por IP)
- ✅ Brute force protection (5 tentativas)
- ✅ Recuperação de senha segura (token único, expiração 1h)
- ✅ Sanitização de inputs (XSS prevention)
- ✅ Prepared statements (SQL injection prevention)

**Exemplo de Rate Limiting:**
```typescript
// Supabase Edge Function
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts'
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

const rateLimiter = new Map<string, { count: number; resetAt: number }>()

serve(async (req) => {
  const ip = req.headers.get('x-forwarded-for') || 'unknown'
  const now = Date.now()
  
  const limit = rateLimiter.get(ip)
  if (limit) {
    if (now < limit.resetAt) {
      if (limit.count >= 100) {
        return new Response('Rate limit exceeded', { status: 429 })
      }
      limit.count++
    } else {
      rateLimiter.set(ip, { count: 1, resetAt: now + 60000 })
    }
  } else {
    rateLimiter.set(ip, { count: 1, resetAt: now + 60000 })
  }
  
  // Process request...
})
```

### 10.7 Regra G: Observabilidade e LGPD

**Implementação:**
- ✅ Logs estruturados com redação de PII
- ✅ Backups automáticos diários (Supabase)
- ✅ Testes de restauração mensais
- ✅ Função `anonymize_user()` para exclusão
- ✅ Métricas de DB (Datadog)

**Exemplo de Log Redigido:**
```typescript
// Ruim
logger.info('User logged in', { email: 'user@example.com', password: '123456' })

// Bom
logger.info('User logged in', { 
  userId: 'uuid-here', 
  timestamp: new Date().toISOString(),
  ip: hashIP(req.ip) // Hash do IP, não IP real
})
```

**Métricas Monitoradas:**
- Query performance (P50, P95, P99)
- Connection pool usage
- Table sizes
- Index usage
- Slow queries (> 100ms)
- Error rates
- Uptime

### 10.8 Regra H: Checklist Obrigatório

**Checklist de Segurança:**
- ✅ `is_adult` implementado e validado
- ✅ `kyc_status` com 4 estados
- ✅ RLS habilitado em todas as tabelas
- ✅ 4 roles criados e configurados
- ✅ pgcrypto habilitado e em uso
- ✅ MFA obrigatório para todos
- ✅ Rate limiting implementado
- ✅ Auditoria via `product_events`
- ✅ Backups automáticos configurados
- ✅ Função de anonimização implementada
- ✅ Secrets no KMS, não em código

**Validação:**
- [ ] Revisão de código por security expert
- [ ] Penetration test por empresa externa
- [ ] Auditoria de conformidade LGPD
- [ ] Testes de carga e stress
- [ ] Disaster recovery drill

### 10.9 Regra I: Recomendações

**Implementadas:**
- ✅ Supabase (Postgres gerenciado)
- ✅ Supabase Vault (KMS)

**Planejadas (Pós-MVP):**
- [ ] KYC externo profissional (Serpro/Serasa)
- [ ] HSM para chaves críticas
- [ ] Revisão legal por advogado especializado
- [ ] Pentests trimestrais
- [ ] Bug bounty program
- [ ] Certificação ISO 27001

### 10.10 Regra J: Conteúdos Obrigatórios no Repo

**Estrutura do Repositório:**
```
/finauto-app
  /frontend
    /src
    /public
    package.json
    tsconfig.json
  /backend
    /supabase
      /functions
      /migrations
      /seeds
  /docs
    /prd
      finauto_prd.md (este documento)
    /security
      security.md
      threat_model.md
      incident_response.md
    /api
      api_documentation.md
  /scripts
    setup.sh
    deploy.sh
  .env.example
  .gitignore
  docker-compose.yml
  README.md
  LICENSE
```

**Conteúdo de `docs/security.md`:**
```markdown
# Documentação de Segurança - FinAuto

## Arquitetura de Segurança

### Autenticação
- Supabase Auth com MFA obrigatório
- JWT com expiração curta (15 min)
- Refresh tokens rotativos

### Autorização
- RBAC: 4 roles (admin, service, app, readonly)
- RLS em nível de banco de dados
- Least privilege

### Criptografia
- TLS 1.3 em trânsito
- pgcrypto em repouso
- Chaves no Supabase Vault

### Validação de Idade
- Trigger SQL: `validate_user_age`
- Validação frontend e backend
- Campo `is_adult` obrigatório

### KYC
- 4 estados: pending, in_review, approved, rejected
- Hash SHA-256 de documentos
- Integração com serviço externo

### Auditoria
- Tabela `product_events`
- Logs estruturados redigidos
- Retenção de 5 anos

### LGPD
- Consentimentos granulares
- Função `anonymize_user()`
- Exportação de dados
- Direito ao esquecimento

## Incidentes de Segurança

### Processo
1. Detecção (alertas automatizados)
2. Contenção (bloqueio imediato)
3. Investigação (análise de logs)
4. Remediação (correção da vulnerabilidade)
5. Comunicação (usuários afetados, ANPD se necessário)

### Contatos
- Security Team: security@finauto.app
- On-call: +55 11 9999-9999

## Testes de Segurança

### Automatizados
- SAST: SonarQube
- DAST: OWASP ZAP
- Dependency scanning: Snyk

### Manuais
- Penetration tests trimestrais
- Code reviews por security expert
- Threat modeling sessions

## Compliance

### LGPD
- DPO: dpo@finauto.app
- Base legal: Consentimento + Execução de contrato
- Retenção: 5 anos (obrigação legal contábil)

### Certificações
- [ ] ISO 27001 (planejado Q3 2026)
- [ ] SOC 2 Type II (planejado Q4 2026)
```

---

## 11. Conclusão

Este PRD detalha completamente o aplicativo FinAuto, um produto de gestão financeira pessoal focado em adultos iniciantes, com os mais altos padrões de segurança e conformidade.

**Diferenciais do FinAuto:**
1. **Interface Conversacional**: Facilita o uso para iniciantes
2. **Segurança Robusta**: KYC, MFA, criptografia, RLS, RBAC
3. **Conformidade Total**: LGPD, validação de idade, auditoria completa
4. **Educação sem Indução**: Informação objetiva, sem recomendações financeiras
5. **Acessibilidade**: WCAG 2.1 AA, linguagem simples

**Próximos Passos:**
1. Aprovação do PRD por stakeholders
2. Kick-off do projeto (Semana 1)
3. Início do desenvolvimento (Fase 1)
4. Revisões semanais de progresso
5. Beta fechado (Semana 10)
6. Lançamento público (Semana 12)

**Contato:**
- Product Manager: pm@finauto.app
- Tech Lead: tech@finauto.app
- Security: security@finauto.app

---

**Versão:** 1.0  
**Última Atualização:** 08/12/2025  
**Status:** Aprovado para Desenvolvimento  
**Próxima Revisão:** Após Beta Fechado (Semana 10)
